<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Daily News</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f4f4f4;
  font-size:17px;
  line-height:1.8;
}
thumb{
  width:100%;
  max-height:220px;
  object-fit:cover;
  border-radius:10px;
  margin-bottom:10px;
}
header{
  background:#d32f2f;
  color:white;
  padding:10px;
  text-align:center;
  position:fixed;
  top:0;
  width:100%;
  z-index:5;
}
header h1{
  margin:0;
  font-size:20px;
  font-weight:600;
}
.menu-btn{
  position:fixed;
  top:12px;
  left:12px;
  background:white;
  color:#d32f2f;
  border:none;
  font-size:28px;
  padding:6px 14px;
  border-radius:8px;
  cursor:pointer;
  z-index:10000;
}
.sidebar{
  position:fixed;
  top:0;
  left:-240px;
  width:240px;
  height:100%;
  background:#222;
  padding-top:70px;
  transition:.3s;
  z-index:9999;
}
.sidebar button{
  width:100%;
  padding:14px;
  background:none;
  border:none;
  color:white;
  text-align:left;
  font-size:16px;
  cursor:pointer;
}
.sidebar button:hover{background:#444}
.main{
  padding:75px 20px 30px;
  max-width:900px;
  margin:auto;
}
.hidden{display:none}
.news-item{
  background:white;
  padding:16px;
  border-radius:8px;
  margin-bottom:16px;
}
.news-item h3{
  font-size:22px;
  cursor:pointer;
  margin:0 0 6px;
}
#viewContent{
  font-size:18px;
  line-height:1.9;
}
.editor{
  border:1px solid #ccc;
  background:white;
  min-height:220px;
  padding:12px;
}
.editor img,
#viewContent img{
  max-width:100%;
  max-height:420px;
  display:block;
  margin:14px auto;
  border-radius:10px;
}
select,input,button{
  padding:10px;
  margin-top:10px;
  font-size:16px;
}
button{cursor:pointer}
</style>
</head>

<body>

<button class="menu-btn" onclick="toggleMenu()">â˜°</button>

<div class="sidebar" id="sidebar">
  <button onclick="filterCat('all')">ğŸ  Home</button>
  <button onclick="filterCat('world')">ğŸŒ World News</button>
  <button onclick="filterCat('crime')">âš–ï¸ Crime</button>
  <button onclick="filterCat('business')">ğŸ’¼ Business</button>
  <button onclick="filterCat('entertainment')">ğŸ­ Entertainment</button>
  <button onclick="showPost()">âœï¸ Post</button>
</div>

<header>
  <h1>ğŸ“° Daily News</h1>
</header>

<div class="main">

<div id="home">

  <input
    id="searchInput"
    placeholder="ğŸ” Search..."
    style="width:100%;padding:10px;font-size:16px;margin-bottom:15px"
    oninput="searchNews(this.value)"
  >

  <div id="newsList"></div>
</div>

<div id="view" class="hidden">
  <h2 id="viewTitle"></h2>
  <div id="viewContent"></div>
  <button onclick="goHome()">â¬… Back</button>
</div>

<div id="post" class="hidden">
  <button onclick="goHome()">â¬… Home</button>
  <h2>ÄÄƒng bÃ i</h2>

  <input id="titleInput" placeholder="Title">

  <select id="categoryInput">
    <option value="world">ğŸŒ World News</option>
    <option value="crime">âš–ï¸ Crime</option>
    <option value="business">ğŸ’¼ Business</option>
    <option value="entertainment">ğŸ­ Entertainment</option>
  </select>
<input type="file" accept="image/*" onchange="setThumb(this)">
<img id="thumbPreview" style="max-width:100%;margin:10px 0;border-radius:8px;display:none">
<input
  id="tagsInput"
  placeholder="Tags (cÃ¡ch nhau báº±ng dáº¥u pháº©y , )"
>
  <div>
    <button onclick="insertImage()">ğŸ–¼ Image</button>
    <button onclick="document.execCommand('bold')"><b>B</b></button>
    <button onclick="document.execCommand('italic')"><i>I</i></button>
  </div>

  <div id="editor" class="editor" contenteditable="true"></div>
  <button onclick="addNews()">ğŸš€ Post</button>
</div>

</div>

<script>
/* ğŸ”¥ FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyD8Uwas9qitijRPRhlISgzzeu-voHHbe_w",
  authDomain:"news-website-12816.firebaseapp.com",
  projectId:"news-website-12816"
});
const db = firebase.firestore();

/* ğŸ”¥ ELEMENTS */
const home = document.getElementById("home");
const post = document.getElementById("post");
const view = document.getElementById("view");

/* ğŸ”¥ STATE */
let news = [];
let currentCat = "all";
let currentTag = "";
let keyword = "";
let editId = null;
let thumbnail = "";

/* ğŸ“‚ MENU */
function toggleMenu(){
  sidebar.style.left = sidebar.style.left==="0px" ? "-240px" : "0px";
}
function show(sec){
  home.classList.add("hidden");
  post.classList.add("hidden");
  view.classList.add("hidden");
  sec.classList.remove("hidden");
  sidebar.style.left="-240px";
}
function showPost(){ show(post); }
function goHome(){
  show(home);
  location.hash="";
}

/* ğŸ–¼ï¸ INSERT IMAGE INTO CONTENT */
function insertImage(){
  const i=document.createElement("input");
  i.type="file";
  i.accept="image/*";
  i.onchange=()=>{
    const r=new FileReader();
    r.onload=()=>document.execCommand("insertImage",false,r.result);
    r.readAsDataURL(i.files[0]);
  };
  i.click();
}

/* ğŸ–¼ï¸ THUMBNAIL */
function setThumb(input){
  const file = input.files[0];
  if(!file) return;
  const r = new FileReader();
  r.onload = ()=>{
    thumbnail = r.result;
    thumbPreview.src = thumbnail;
    thumbPreview.style.display = "block";
  };
  r.readAsDataURL(file);
}

/* ğŸ”— SLUG */
function slugify(t){
  return t.toLowerCase().normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9]+/g,"-")
    .replace(/^-|-$/g,"");
}

/* â• ADD / UPDATE */
function addNews(){
  const title = titleInput.value.trim();
  const content = editor.innerHTML.trim();
  if(!title || !content) return alert("Thiáº¿u ná»™i dung");

  const tags = tagsInput.value
    .split(",")
    .map(t=>t.trim().toLowerCase())
    .filter(t=>t);

  const data = {
    title,
    slug: slugify(title),
    category: categoryInput.value,
    tags,            // ğŸ·ï¸ TAGS
    thumbnail,
    content,
    created: firebase.firestore.FieldValue.serverTimestamp()
  };

  if(editId){
    db.collection("news").doc(editId).update(data);
    editId = null;
  }else{
    db.collection("news").add(data);
  }

  titleInput.value = "";
  editor.innerHTML = "";
  tagsInput.value = "";
  thumbnail = "";
  thumbPreview.style.display = "none";
  goHome();
}

/* ğŸ“° LOAD */
db.collection("news").orderBy("created","desc")
.onSnapshot(s=>{
  news = [];
  s.forEach(d=>news.push({id:d.id,...d.data()}));
  render();
  openFromHash();
});

/* ğŸ” SEARCH */
function searchNews(k){
  keyword = k.toLowerCase();
  render();
}

/* ğŸ–¥ï¸ RENDER */
function render(){
  newsList.innerHTML = "";

  news.forEach(n=>{
    const cat = n.category || "world";
    if(currentCat!=="all" && cat!==currentCat) return;

    if(currentTag){
      if(!n.tags || !n.tags.includes(currentTag)) return;
    }

    if(keyword){
      const text = (n.title + " " + n.content).toLowerCase();
      if(!text.includes(keyword)) return;
    }

    const catLabel =
      cat==="world" ? "ğŸŒ World" :
      cat==="crime" ? "âš–ï¸ Crime" :
      cat==="business" ? "ğŸ’¼ Business" :
      "ğŸ­ Entertainment";

    newsList.innerHTML += `
      <div class="news-item">
        ${n.thumbnail ? `<img src="${n.thumbnail}" class="thumb">` : ""}

        <h3 onclick="openNews('${n.slug}')">${n.title}</h3>

        <small>${catLabel}</small>

        <div class="tags">
          ${(n.tags||[]).map(t=>`
            <span class="tag" onclick="filterTag('${t}')">#${t}</span>
          `).join("")}
        </div>

        <select onchange="changeCat('${n.id}',this.value)">
          <option value="world" ${cat==="world"?"selected":""}>ğŸŒ World</option>
          <option value="crime" ${cat==="crime"?"selected":""}>âš–ï¸ Crime</option>
          <option value="business" ${cat==="business"?"selected":""}>ğŸ’¼ Business</option>
          <option value="entertainment" ${cat==="entertainment"?"selected":""}>ğŸ­ Entertainment</option>
        </select>

        <button onclick="editNews('${n.id}')">âœï¸ edit</button>
        <button onclick="del('${n.id}')">âŒ DELETE</button>
      </div>
    `;
  });
}

/* ğŸ“‚ CATEGORY & TAG */
function filterCat(c){
  currentCat = c;
  currentTag = "";
  show(home);
  render();
}
function filterTag(t){
  currentTag = t;
  show(home);
  render();
}
function changeCat(id,c){
  db.collection("news").doc(id).update({category:c});
}

/* âŒ DELETE */
function del(id){
  if(confirm("Delete post?"))
    db.collection("news").doc(id).delete();
}

/* ğŸ‘ï¸ VIEW */
function openNews(slug){
  const n = news.find(x=>x.slug===slug);
  if(!n) return;
  show(view);
  viewTitle.innerText = n.title;
  viewContent.innerHTML = `
    <div class="tags">
      ${(n.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join("")}
    </div>
    ${n.content}
  `;
  location.hash = "/"+slug;
}

/* âœï¸ EDIT */
function editNews(id){
  const n = news.find(x=>x.id===id);
  if(!n) return;
  editId = id;
  titleInput.value = n.title;
  categoryInput.value = n.category;
  tagsInput.value = (n.tags||[]).join(", ");
  editor.innerHTML = n.content;
  thumbnail = n.thumbnail || "";
  if(thumbnail){
    thumbPreview.src = thumbnail;
    thumbPreview.style.display = "block";
  }
  show(post);
}

/* ğŸ”— URL HASH */
function openFromHash(){
  if(!location.hash) return;
  const slug = location.hash.replace("#/","");
  const n = news.find(x=>x.slug===slug);
  if(n) openNews(slug);
}
</script>

</body>
</html>
