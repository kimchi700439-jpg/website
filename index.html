<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily News</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#d32f2f;color:#fff;padding:18px;text-align:center}
nav{background:#fff;padding:10px;display:flex;justify-content:space-around}
nav button{padding:10px 16px;border:none;background:#d32f2f;color:#fff;border-radius:6px}
.container{padding:16px;max-width:900px;margin:auto}
.hidden{display:none}
.news-item{background:#fff;padding:16px;margin-bottom:16px;border-radius:8px}
.news-item h3{cursor:pointer}
.actions button{padding:7px 12px;border:none;border-radius:5px;color:#fff}
.delete{background:#d32f2f}
.restore{background:#388e3c}
.forever{background:#555}
.editor{border:1px solid #ccc;background:#fff;padding:14px;min-height:200px}
.editor img,#viewContent img{max-width:100%;display:block;margin:12px auto;border-radius:8px}
input{width:100%;padding:12px;margin-bottom:12px}
.submit{width:100%;padding:12px;background:#d32f2f;color:#fff;border:none;border-radius:6px}
</style>
</head>

<body>

<header><h1>ðŸ“° Daily News</h1></header>

<nav>
  <button onclick="goHome()">Home</button>
  <button onclick="showPost()">Post</button>
  <button onclick="showTrash()">Trash</button>
</nav>

<div class="container">

<!-- HOME -->
<div id="home"><div id="newsList"></div></div>

<!-- VIEW -->
<div id="view" class="hidden">
  <h2 id="viewTitle"></h2>
  <div id="viewContent"></div>
  <button onclick="goHome()">â¬… Back</button>
</div>

<!-- POST -->
<div id="post" class="hidden">
  <h2>Post News</h2>
  <input id="titleInput" placeholder="News title">
  <button onclick="insertImage()">ðŸ–¼ Image</button>
  <div id="editor" class="editor" contenteditable="true"></div>
  <button class="submit" onclick="addNews()">Publish</button>
</div>

<!-- TRASH -->
<div id="trash" class="hidden">
  <h2>ðŸ—‘ Trash Bin</h2>
  <div id="trashList"></div>
</div>

</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey:"AIzaSyD8Uwas9qitijRPRhlISgzzeu-voHHbe_w",
  authDomain:"news-website-12816.firebaseapp.com",
  projectId:"news-website-12816"
});
const db=firebase.firestore();

/* ===== DOM ===== */
const home=document.getElementById("home");
const view=document.getElementById("view");
const post=document.getElementById("post");
const trash=document.getElementById("trash");
const newsList=document.getElementById("newsList");
const trashList=document.getElementById("trashList");
const titleInput=document.getElementById("titleInput");
const editor=document.getElementById("editor");
const viewTitle=document.getElementById("viewTitle");
const viewContent=document.getElementById("viewContent");

/* ===== UTIL ===== */
function slugify(t){return t.toLowerCase().trim().replace(/[\s\W-]+/g,"-")}
function showOnly(s){
  [home,view,post,trash].forEach(x=>x.classList.add("hidden"));
  s.classList.remove("hidden");
}
function goHome(){
  history.pushState({}, "", location.pathname);
  showOnly(home);
}
function showPost(){showOnly(post)}
function showTrash(){showOnly(trash);loadTrash()}

/* ===== IMAGE ===== */
function insertImage(){
  const i=document.createElement("input");
  i.type="file";i.accept="image/*";
  i.onchange=()=>{
    const r=new FileReader();
    r.onload=()=>document.execCommand("insertImage",false,r.result);
    r.readAsDataURL(i.files[0]);
  };
  i.click();
}

/* ===== ADD NEWS ===== */
function addNews(){
  if(!titleInput.value||!editor.innerHTML) return alert("Thiáº¿u ná»™i dung");
  const slug=slugify(titleInput.value);
  db.collection("news").add({
    title:titleInput.value,
    slug:slug,
    content:editor.innerHTML,
    deleted:false,
    created:firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    titleInput.value="";editor.innerHTML="";
    goHome();
  });
}

/* ===== LOAD HOME ===== */
db.collection("news")
.where("deleted","==",false)
.orderBy("created","desc")
.onSnapshot(snap=>{
  newsList.innerHTML="";
  snap.forEach(doc=>{
    const n={id:doc.id,...doc.data()};
    newsList.innerHTML+=`
      <div class="news-item">
        <h3 onclick="openNews('${n.slug}')">${n.title}</h3>
        <div class="actions">
          <button class="delete" onclick="moveToTrash('${n.id}')">Delete</button>
        </div>
      </div>`;
  });
});

/* ===== VIEW ===== */
function openNews(slug){
  history.pushState({}, "", "?news="+slug);
  loadFromURL();
}
function loadFromURL(){
  const slug=new URLSearchParams(location.search).get("news");
  if(!slug){showOnly(home);return;}
  db.collection("news").where("slug","==",slug).limit(1).get()
  .then(s=>{
    if(!s.empty){
      const d=s.docs[0].data();
      viewTitle.innerText=d.title;
      viewContent.innerHTML=d.content;
      showOnly(view);
    }
  });
}
window.onpopstate=loadFromURL;
loadFromURL();

/* ===== TRASH ===== */
function moveToTrash(id){
  if(confirm("Chuyá»ƒn vÃ o thÃ¹ng rÃ¡c?")){
    db.collection("news").doc(id).update({deleted:true});
  }
}
function loadTrash(){
  trashList.innerHTML="";
  db.collection("news").where("deleted","==",true).get()
  .then(snap=>{
    snap.forEach(doc=>{
      const n={id:doc.id,...doc.data()};
      trashList.innerHTML+=`
        <div class="news-item">
          <h3>${n.title}</h3>
          <div class="actions">
            <button class="restore" onclick="restoreNews('${n.id}')">Restore</button>
            <button class="forever" onclick="deleteForever('${n.id}')">Delete Forever</button>
          </div>
        </div>`;
    });
  });
}
function restoreNews(id){
  db.collection("news").doc(id).update({deleted:false});
  loadTrash();
}
function deleteForever(id){
  if(confirm("XÃ³a vÄ©nh viá»…n?")){
    db.collection("news").doc(id).delete();
    loadTrash();
  }
}
</script>

</body>
</html>
