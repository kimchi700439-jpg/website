<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily News</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; font-size:16px; line-height:1.6; }
header { background:#d32f2f; color:white; padding:18px; text-align:center; }
nav { background:white; padding:10px; display:flex; justify-content:space-around; }
nav button { padding:10px 16px; border:none; background:#d32f2f; color:white; border-radius:6px; }
.container { padding:16px; max-width:900px; margin:auto; }
.hidden { display:none; }
.news-item { background:white; padding:16px; margin-bottom:16px; border-radius:8px; }
.news-item h3 { margin:0 0 10px; cursor:pointer; }
.actions { margin-top:10px; }
.actions button { padding:7px 12px; border:none; border-radius:5px; color:white; }
.delete { background:#d32f2f; }
.editor { border:1px solid #ccc; background:white; padding:14px; min-height:220px; }
.editor img, #viewContent img { max-width:100%; display:block; margin:12px auto; border-radius:8px; }
.toolbar button { padding:8px 12px; margin-right:5px; }
input { width:100%; padding:12px; margin-bottom:12px; }
.submit { width:100%; padding:12px; background:#d32f2f; color:white; border:none; border-radius:6px; }
</style>
</head>

<body>

<header><h1>ðŸ“° Daily News</h1></header>

<nav>
  <button onclick="goHome()">Home</button>
  <button onclick="showPost()">Post</button>
</nav>

<div class="container">

<!-- HOME -->
<div id="home">
  <div id="newsList"></div>
</div>

<!-- VIEW -->
<div id="view" class="hidden">
  <h2 id="viewTitle"></h2>
  <div id="viewContent"></div>
  <button onclick="goHome()">â¬… Back</button>
</div>

<!-- POST -->
<div id="post" class="hidden">
  <h2>Post News</h2>
  <input id="titleInput" placeholder="News title">
  <div class="toolbar">
    <button onclick="insertImage()">ðŸ–¼ Image</button>
    <button onclick="document.execCommand('bold')"><b>B</b></button>
    <button onclick="document.execCommand('italic')"><i>I</i></button>
  </div>
  <div id="editor" class="editor" contenteditable="true"></div>
  <button class="submit" onclick="addNews()">Publish</button>
</div>

</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey: "AIzaSyD8Uwas9qitijRPRhlISgzzeu-voHHbe_w",
  authDomain: "news-website-12816.firebaseapp.com",
  projectId: "news-website-12816"
});
const db = firebase.firestore();

/* ===== DOM ===== */
const home = document.getElementById("home");
const view = document.getElementById("view");
const post = document.getElementById("post");
const newsList = document.getElementById("newsList");
const titleInput = document.getElementById("titleInput");
const editor = document.getElementById("editor");
const viewTitle = document.getElementById("viewTitle");
const viewContent = document.getElementById("viewContent");

let news = [];

/* ===== UTIL ===== */
function slugify(text){
  return text.toLowerCase().trim().replace(/[\s\W-]+/g,"-");
}
function showOnly(el){
  home.classList.add("hidden");
  view.classList.add("hidden");
  post.classList.add("hidden");
  el.classList.remove("hidden");
}
function goHome(){
  history.pushState({}, "", location.pathname);
  showOnly(home);
}
function showPost(){ showOnly(post); }

/* ===== IMAGE ===== */
function insertImage(){
  const i = document.createElement("input");
  i.type = "file";
  i.accept = "image/*";
  i.onchange = ()=>{
    const r = new FileReader();
    r.onload = ()=>document.execCommand("insertImage",false,r.result);
    r.readAsDataURL(i.files[0]);
  };
  i.click();
}

/* ===== ADD NEWS ===== */
function addNews(){
  const slug = slugify(titleInput.value);
  if(!titleInput.value || !editor.innerHTML) return alert("Missing content");

  db.collection("news").add({
    title: titleInput.value,
    slug: slug,
    content: editor.innerHTML,
    created: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    titleInput.value="";
    editor.innerHTML="";
    goHome();
  });
}

/* ===== LOAD NEWS ===== */
db.collection("news").orderBy("created","desc")
.onSnapshot(snap=>{
  news=[];
  newsList.innerHTML="";
  snap.forEach(doc=>{
    const n = {id:doc.id,...doc.data()};
    news.push(n);
    newsList.innerHTML+=`
      <div class="news-item">
        <h3 onclick="openNews('${n.slug}')">${n.title}</h3>
        <div class="actions">
          <button class="delete" onclick="deleteNews('${n.id}')">Delete</button>
        </div>
      </div>`;
  });
});

/* ===== OPEN NEWS ===== */
function openNews(slug){
  history.pushState({}, "", "?news="+slug);
  loadFromURL();
}

/* ===== DELETE ===== */
function deleteNews(id){
  if(confirm("Delete this article?")){
    db.collection("news").doc(id).delete();
  }
}

/* ===== LOAD FROM URL ===== */
function loadFromURL(){
  const slug = new URLSearchParams(location.search).get("news");
  if(!slug){ showOnly(home); return; }

  db.collection("news").where("slug","==",slug).limit(1).get()
  .then(snap=>{
    if(!snap.empty){
      const d = snap.docs[0].data();
      viewTitle.innerText = d.title;
      viewContent.innerHTML = d.content;
      showOnly(view);
    }
  });
}

window.onpopstate = loadFromURL;
loadFromURL();
</script>

</body>
</html>
