<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Daily News</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f4f4f4;
  font-size:17px;
  line-height:1.8;
}

/* HEADER */
header{
  background:#d32f2f;
  color:white;
  padding:10px;
  text-align:center;
  position:fixed;
  top:0;
  width:100%;
  z-index:5;
}
header h1{
  font-size:20px;
  margin:0;
  font-weight:600;
}

/* MENU BUTTON */
.menu-btn{
  position:fixed;
  top:12px;
  left:12px;
  background:white;
  color:#d32f2f;
  border:none;
  font-size:26px;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  z-index:10000;
}

/* SIDEBAR */
.sidebar{
  position:fixed;
  top:0;
  left:-240px;
  width:240px;
  height:100%;
  background:#222;
  padding-top:70px;
  transition:0.3s;
  z-index:9999;
}
.sidebar button{
  width:100%;
  padding:14px;
  background:none;
  border:none;
  color:white;
  font-size:16px;
  text-align:left;
  cursor:pointer;
}
.sidebar button:hover{background:#444}

/* MAIN */
.main{
  padding:70px 20px 30px;
  max-width:900px;
  margin:auto;
}

/* COMMON */
.hidden{display:none}
button,select,input{padding:10px;font-size:16px;margin-top:10px}
button{cursor:pointer}

/* NEWS LIST */
.news-item{
  background:white;
  padding:16px;
  border-radius:8px;
  margin-bottom:16px;
}
.news-item h3{
  margin:0 0 6px;
  font-size:22px;
  cursor:pointer;
}

/* VIEW */
#viewContent{
  font-size:18px;
  line-height:1.9;
}

/* EDITOR */
.editor{
  border:1px solid #ccc;
  background:white;
  min-height:220px;
  padding:12px;
  font-size:17px;
}
.editor img,
#viewContent img{
  max-width:100%;
  max-height:420px;
  display:block;
  margin:14px auto;
  border-radius:10px;
}
</style>
</head>

<body>

<button class="menu-btn" onclick="toggleMenu()">â˜°</button>

<div class="sidebar" id="sidebar">
  <button onclick="filterCat('all')">ğŸ  Trang chá»§</button>
  <button onclick="filterCat('world')">ğŸŒ Thá»i sá»± tháº¿ giá»›i</button>
  <button onclick="filterCat('crime')">âš–ï¸ Ãn máº¡ng</button>
  <button onclick="filterCat('business')">ğŸ’¼ Kinh doanh</button>
  <button onclick="filterCat('entertainment')">ğŸ­ Giáº£i trÃ­</button>
  <button onclick="showPost()">âœï¸ ÄÄƒng bÃ i</button>
</div>

<header>
  <h1>ğŸ“° Daily News</h1>
</header>

<div class="main">

<!-- HOME -->
<div id="home">
  <div id="newsList"></div>
</div>

<!-- VIEW -->
<div id="view" class="hidden">
  <h2 id="viewTitle"></h2>
  <div id="viewContent"></div>
  <button onclick="goHome()">â¬… Quay láº¡i</button>
</div>

<!-- POST -->
<div id="post" class="hidden">
  <button onclick="goHome()">â¬… Trang chá»§</button>
  <h2>ÄÄƒng bÃ i</h2>

  <input id="titleInput" placeholder="TiÃªu Ä‘á»">

  <select id="categoryInput">
    <option value="world">ğŸŒ Thá»i sá»± tháº¿ giá»›i</option>
    <option value="crime">âš–ï¸ Ãn máº¡ng</option>
    <option value="business">ğŸ’¼ Kinh doanh</option>
    <option value="entertainment">ğŸ­ Giáº£i trÃ­</option>
  </select>

  <div>
    <button onclick="insertImage()">ğŸ–¼ áº¢nh</button>
    <button onclick="document.execCommand('bold')"><b>B</b></button>
    <button onclick="document.execCommand('italic')"><i>I</i></button>
  </div>

  <div id="editor" class="editor" contenteditable="true"></div>

  <button onclick="addNews()">ğŸš€ ÄÄƒng bÃ i</button>
</div>

</div>

<script>
/* FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyD8Uwas9qitijRPRhlISgzzeu-voHHbe_w",
  authDomain: "news-website-12816.firebaseapp.com",
  projectId: "news-website-12816"
});
const db = firebase.firestore();

/* SECTIONS */
const home = document.getElementById("home");
const post = document.getElementById("post");
const view = document.getElementById("view");

/* MENU */
function toggleMenu(){
  sidebar.style.left = sidebar.style.left === "0px" ? "-240px" : "0px";
}

/* SHOW */
function show(sec){
  home.classList.add("hidden");
  post.classList.add("hidden");
  view.classList.add("hidden");
  sec.classList.remove("hidden");
  sidebar.style.left = "-240px";
}
function showPost(){ show(post); }
function goHome(){ show(home); }

/* IMAGE */
function insertImage(){
  const i = document.createElement("input");
  i.type = "file";
  i.accept = "image/*";
  i.onchange = () => {
    const r = new FileReader();
    r.onload = () => document.execCommand("insertImage", false, r.result);
    r.readAsDataURL(i.files[0]);
  };
  i.click();
}

/* SLUG */
function slugify(t){
  return t.toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9]+/g,"-")
    .replace(/^-|-$/g,"");
}

/* ADD NEWS */
function addNews(){
  const title = titleInput.value.trim();
  const content = editor.innerHTML.trim();
  if(!title || !content){
    alert("Vui lÃ²ng nháº­p tiÃªu Ä‘á» vÃ  ná»™i dung");
    return;
  }
  db.collection("news").add({
    title,
    slug: slugify(title),
    category: categoryInput.value,
    content,
    created: firebase.firestore.FieldValue.serverTimestamp()
  });
  titleInput.value="";
  editor.innerHTML="";
  goHome();
}

/* LOAD + RENDER */
let news=[], currentCat="all";
db.collection("news").orderBy("created","desc")
.onSnapshot(s=>{
  news=[];
  s.forEach(d=>news.push({id:d.id,...d.data()}));
  render();
});

function render(){
  newsList.innerHTML="";
  news.forEach(n=>{
    const cat = n.category || "world";
    if(currentCat!=="all" && cat!==currentCat) return;

    newsList.innerHTML+=`
      <div class="news-item">
        <h3 onclick="openNews('${n.slug}')">${n.title}</h3>
        <small>
          ${cat==="world"?"ğŸŒ Tháº¿ giá»›i":cat==="crime"?"âš–ï¸ Ãn máº¡ng":cat==="business"?"ğŸ’¼ Kinh doanh":"ğŸ­ Giáº£i trÃ­"}
        </small><br>
        <select onchange="changeCat('${n.id}',this.value)">
          <option value="world" ${cat==="world"?"selected":""}>ğŸŒ</option>
          <option value="crime" ${cat==="crime"?"selected":""}>âš–ï¸</option>
          <option value="business" ${cat==="business"?"selected":""}>ğŸ’¼</option>
          <option value="entertainment" ${cat==="entertainment"?"selected":""}>ğŸ­</option>
        </select>
        <button onclick="del('${n.id}')">âŒ XÃ³a</button>
      </div>`;
  });
}

function filterCat(c){
  currentCat=c;
  show(home);
  render();
}

/* DELETE */
function del(id){
  if(confirm("XÃ³a bÃ i viáº¿t?")){
    db.collection("news").doc(id).delete();
  }
}

/* VIEW */
function openNews(slug){
  const n=news.find(x=>x.slug===slug);
  if(!n) return;
  show(view);
  viewTitle.innerText=n.title;
  viewContent.innerHTML=n.content;
}
</script>

</body>
</html>
